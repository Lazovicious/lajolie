<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zakazivanje termina</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    select:invalid {
      color: gray;
    }
    option[disabled][hidden] {
      display: none;
    }
    select option:checked::before {
      content: none;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-[#f2eaea] to-[#e2d3d3] min-h-screen flex items-center justify-center p-4">
  <div class="bg-white/60 backdrop-blur-md rounded-3xl shadow-2xl w-full max-w-md">
    <div class="flex justify-center relative">
      <div class="absolute left-0 h-[15rem] w-6 bg-[#f2eaea] rounded-l-3xl"></div>
      <div class="absolute left-6 h-[15rem] w-6 bg-[#f2eaea] rounded"></div>
      <div class="absolute left-12 h-[15rem] w-6 bg-[#f2eaea] rounded"></div>
      <div class="absolute left-16 h-[15rem] w-8 bg-[#f2eaea] rounded-r-3x1"></div>
      <div class="absolute right-0 h-[15rem] w-6 bg-[#f2eaea] rounded-r-3xl"></div>
      <div class="absolute right-6 h-[15rem] w-6 bg-[#f2eaea] rounded"></div>
      <div class="absolute right-12 h-[15rem] w-6 bg-[#f2eaea] rounded"></div>
      <div class="absolute right-16 h-[15rem] w-8 bg-[#f2eaea] rounded"></div>
      <img src="https://i.imgur.com/0sKGZVj.png" alt="Logo greska" class="h-[15rem] z-10">
    </div>
    <div class="p-8">
      <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Zakazivanje termina</h1>
      <form id="appointmentForm" class="space-y-6 text-gray-800">
        <div>
          <label for="imePrezime" class="block mb-2 text-sm font-medium">Ime i prezime</label>
          <input type="text" id="imePrezime" name="imePrezime" class="w-full border border-gray-300 rounded-xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 bg-white/80" required />
        </div>

        <div>
          <label for="telefon" class="block mb-2 text-sm font-medium">Broj telefona</label>
          <input type="tel" id="telefon" name="telefon" pattern="[0-9\s\-+()]{6,}" class="w-full border border-gray-300 rounded-xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 bg-white/80" required />
        </div>

        <div>
          <label for="mainService" class="block mb-2 text-sm font-medium">Šta radimo</label>
          <select id="mainService" name="mainService" class="w-full border border-gray-300 rounded-xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 bg-white/80" required>
            <option value="" disabled selected hidden></option>
            <option value="noviSet">Novi set noktiju</option>
            <option value="korekcija">Korekcija</option>
          </select>
        </div>

        <div id="noviSetOptions" class="hidden space-y-5">
          <div>
            <label class="block mb-2 text-sm font-medium">Vrsta rada</label>
            <select id="noviSetType" name="noviSetType" class="w-full border border-gray-300 rounded-xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 bg-white/80">
              <option value="" disabled selected hidden></option>
              <option value="sabloni">Izlivanje noktiju šablonima</option>
              <option value="tipsama">Izlivanje noktiju gornjim tipsama</option>
              <option value="nadogradnja">Nadogradnja noktiju</option>
            </select>
          </div>

          <div id="subOptions" class="space-y-5">
            <div>
              <label for="duzina" class="block mb-2 text-sm font-medium">Dužina</label>
              <select id="duzina" class="w-full border border-gray-300 rounded-xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 bg-white/80">
                <option value="" disabled selected hidden></option>
                <option value="kratki">Kratki</option>
                <option value="srednji">Srednji</option>
                <option value="dugi">Dugi</option>
              </select>
            </div>

            <div>
              <label for="oblik" class="block mb-2 text-sm font-medium">Oblik</label>
              <select id="oblik" class="w-full border border-gray-300 rounded-xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 bg-white/80">
                <option value="" disabled selected hidden></option>
                <option value="kocka">Kocka</option>
                <option value="uskaKocka">Uska kocka</option>
                <option value="badem">Badem</option>
                <option value="spicasti">Špicasti</option>
                <option value="ovalni">Ovalni</option>
                <option value="drugo">Drugo</option>
              </select>
            </div>

            <div>
              <label class="block mb-2 text-sm font-medium">Dizajn noktiju, opcije</label>
              <div class="flex flex-col gap-1">
                <label class="inline-flex items-start space-x-2 text-gray-700 text-sm">
                  <input type="checkbox" id="boja" class="form-checkbox rounded text-pink-600 focus:ring-pink-400 mt-1" value="boja" />
                  <span>Boja</span>
                </label>
                <label class="inline-flex items-start space-x-2 text-gray-700 text-sm">
                  <input type="checkbox" id="french" class="form-checkbox rounded text-pink-600 focus:ring-pink-400 mt-1" value="french" />
                  <span>French</span>
                </label>
                <label class="inline-flex items-start space-x-2 text-gray-700 text-sm max-w-xs">
                  <input type="checkbox" id="ostalo" class="form-checkbox rounded text-pink-600 focus:ring-pink-400 mt-1" value="ostalo" />
                  <span>Ostalo (Crtanje, Nakit, 3D, Cat-eye itd)</span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <div>
          <label for="date" class="block mb-2 text-sm font-medium">Dan termina</label>
          <select id="date" name="date" class="w-full border border-gray-300 rounded-xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 bg-white/80" required>
            <option value="" disabled selected hidden></option>
          </select>
        </div>

        <div>
          <label for="time" class="block mb-2 text-sm font-medium">Vreme termina</label>
          <select id="time" name="time" class="w-full border border-gray-300 rounded-xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 bg-white/80" required>
            <option value="" disabled selected hidden></option>
          </select>
        </div>

        <div>
          <label for="komentar" class="block mb-2 text-sm font-medium">Napomene</label>
          <textarea id="komentar" class="w-full border border-gray-300 rounded-xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-pink-400 bg-white/80 resize-none"></textarea>
        </div>

        <div class="text-center text-sm text-gray-600 font-medium">
          <div id="durationDisplay">-</div>
          <div id="priceDisplay">Okvirna cena rada: -</div>
        </div>

        <button type="submit" class="w-full bg-pink-600 text-white py-3 px-4 rounded-xl font-semibold text-sm hover:bg-pink-700 transition duration-200">
          Zakaži
        </button>
      </form>

      <div id="message" class="mt-4 text-center font-semibold"></div>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<script>
  const supabaseUrl = 'https://xkljqcxonrnstuivtihc.supabase.co';
  const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhrbGpxY3hvbnJuc3R1aXZ0aWhjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc5MjA3MTQsImV4cCI6MjA2MzQ5NjcxNH0.iL55srspAJd1FMY3HBEdbY2tCysC8rwmEsoxS39yu3Y';

  // Create Supabase client instance with a new variable name
  const supabaseClient = supabase.createClient(supabaseUrl, supabaseAnonKey);
</script>
  
  
  <script>
    const mainService = document.getElementById("mainService");
    const noviSetOptions = document.getElementById("noviSetOptions");
    const durationDisplay = document.getElementById("durationDisplay");
    const priceDisplay = document.getElementById("priceDisplay");

    mainService.addEventListener("change", () => {
      noviSetOptions.classList.toggle("hidden", mainService.value !== "noviSet");
      calculateEstimates();
    });

    document.querySelectorAll("#noviSetOptions select, #noviSetOptions input[type=checkbox]").forEach(el => {
      el.addEventListener("change", calculateEstimates);
    });

    function calculateEstimates() {
      let duration = 60; // base
      let price = 3000; // base example

      const duzina = document.getElementById("duzina").value;
      const ostalo = document.getElementById("ostalo").checked;

      if (duzina === "srednji" || duzina === "dugi") duration += 30;
      if (ostalo) duration += 30;

      durationDisplay.textContent = `Procena trajanja: ${duration} min`;
      priceDisplay.textContent = `Okvirna cena rada: ${price} RSD`;
    }

    const dateSelect = document.getElementById("date");
    const timeSelect = document.getElementById("time");

    const now = new Date();
    for (let i = 0; i < 14; i++) {
      const date = new Date(now);
      date.setDate(now.getDate() + i);
      const option = document.createElement("option");
      option.value = date.toISOString().split("T")[0];
      option.textContent = date.toLocaleDateString("sr-RS", { weekday: "long", day: "numeric", month: "long" });
      dateSelect.appendChild(option);
    }

    const times = ["09:00", "10:30", "12:00", "13:30", "15:00", "16:30", "18:00"];
    times.forEach(time => {
      const option = document.createElement("option");
      option.value = time;
      option.textContent = time;
      timeSelect.appendChild(option);
    });

    document.getElementById("appointmentForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const designOptions = [];
    if (document.getElementById("boja").checked) designOptions.push("Boja");
    if (document.getElementById("french").checked) designOptions.push("French");
    if (document.getElementById("ostalo").checked) designOptions.push("Ostalo");

    // Use supabaseClient here instead of supabase
    const { data, error } = await supabaseClient
      .from("appointments")
      .insert([
        {
          name_lastname: document.getElementById("imePrezime").value,
          phone: document.getElementById("telefon").value,
          main_service: document.getElementById("mainService").value,
          sub_service: document.getElementById("noviSetType").value || null,
          length: document.getElementById("duzina").value || null,
          shape: document.getElementById("oblik").value || null,
          design: designOptions,
          date: document.getElementById("date").value,
          time: document.getElementById("time").value,
          notes: document.getElementById("komentar").value
        }
      ]);

    const messageDiv = document.getElementById("message");
    if (error) {
      messageDiv.textContent = "Greška pri zakazivanju. Pokušajte ponovo.";
      messageDiv.classList.add("text-red-600");
      messageDiv.classList.remove("text-green-600");
    } else {
      messageDiv.textContent = "Uspešno ste zakazali termin!";
      messageDiv.classList.remove("text-red-600");
      messageDiv.classList.add("text-green-600");
    }
  });
</script>
</body>
</html>
